package test;

import java.awt.Component;
import java.awt.Cursor;
import java.awt.Dimension;
import java.awt.Insets;
import java.awt.Point;
import java.awt.event.MouseEvent;

import javax.swing.border.Border;
import javax.swing.event.MouseInputListener;

public class ResizeListener implements MouseInputListener {

	private int top_inset, bottom_inset, left_inset, right_inset;
	
	public ResizeListener(Insets border_inset) {
		top_inset = border_inset.top;
		bottom_inset = border_inset.bottom;
		left_inset = border_inset.left;
		right_inset = border_inset.right;
	}
	
	@Override
	public void mouseClicked(MouseEvent arg0) {
		// TODO Auto-generated method stub
		
	}

	private ResizablePanel current_panel = null;
	private int min_width, min_height,
				left_side, right_side,
				top_side, bottom_side;
				
	@Override
	public void mouseEntered(MouseEvent e) {
		current_panel = (ResizablePanel) e.getComponent();
		min_width = (int) current_panel.getMinimumSize().getWidth();
		min_height = (int) current_panel.getMinimumSize().getHeight();
		
		left_side = current_panel.getLeftSide();
		right_side = current_panel.getRightSide();
		top_side = current_panel.getTopSide();
		bottom_side = current_panel.getBottomSide();
	}

	@Override
	public void mouseExited(MouseEvent e) {
//		current_panel = null;
	}

	private Point start_point = null;
	
	@Override
	public void mousePressed(MouseEvent e) {
		start_point = e.getPoint();
//		start_point = e.getLocationOnScreen();
//		current_panel.requestFocus();
	}

	@Override
	public void mouseReleased(MouseEvent e) {
		//Reset start point
//		start_point = null;
	}

	private int x, y, w, h, dx, dy;
	
	@Override
	public void mouseDragged(MouseEvent e) {
		if(current_panel.getCursor() != Cursor.getDefaultCursor()) {

			x = current_panel.getX();
			y = current_panel.getY();
			w = current_panel.getWidth();
			h = current_panel.getHeight();

			dx = e.getX() - start_point.x;
			dy = e.getY() - start_point.y;
			
//			System.out.println("Mouse X: " + e.getX());
//			System.out.println("Mouse Y: " + e.getY());
//			System.out.println("Start X: " + start_point.x);
//			System.out.println("Start Y: " + start_point.y);
//			System.out.println("DX: " + dx);
//			System.out.println("DY: " + dy);
//			System.out.println();
			
//			dx = e.getXOnScreen() - start_point.x;
//			dy = e.getYOnScreen() - start_point.y;

			switch(current_panel.getCursor().getType()) {
			case Cursor.NW_RESIZE_CURSOR:
				if(w - dx <= min_width) {
					x = right_side - min_width;
					w = min_width;
				} else {
					x += dx;
					w -= dx;
				}
				
				if(h - dy <= min_height) {
					y = bottom_side - min_height;
					h = min_height;
				} else {
					y += dy;
					h -= dy;
				}
				
				setBounds(x, y, w, h);
				break;
				
			case Cursor.N_RESIZE_CURSOR:
				if(h - dy <= min_height) {
					y = bottom_side - min_height;
					h = min_height;
//					setBounds(x, bottom_side - min_height, w, min_height);
//					start_point = new Point(x, top_inset);
//					start_point = new Point(x, current_panel.getLocationOnScreen().y + current_panel.getHeight() - min_height + top_inset);
				} else {
					y += dy;
					h -= dy;
//					setBounds(x, y + dy, w, h - dy);
//					start_point = e.getLocationOnScreen();
				}
				
				setBounds(x, y, w, h);
				break;
				
			case Cursor.NE_RESIZE_CURSOR:
				if(w + dx <= min_width) {
					w = min_width;
					start_point.setLocation(min_width - right_inset, start_point.y);
				} else {
					w += dx;
					start_point.setLocation(e.getX(), start_point.y);
				}
				
				if(h - dy <= min_height) {
					y = bottom_side - min_height;
					h = min_height;
				} else {
					y += dy;
					h -= dy;
				}
				
				setBounds(x, y, w, h);
//				setBounds(x, y + dy, w + dx, h - dy);
				break;
				
			case Cursor.E_RESIZE_CURSOR:
				if(w + dx <= min_width) {
					w = min_width;
					start_point.setLocation(min_width - right_inset, start_point.y);
				} else {
					w += dx;
					start_point.setLocation(e.getX(), start_point.y);
				}
				
				setBounds(x, y, w, h);
				//setBounds(x, y, w + dx, h);
				break;
				
			case Cursor.SE_RESIZE_CURSOR:
				if(w + dx <= min_width) {
					w = min_width;
					start_point.setLocation(min_width - right_inset, start_point.y);
				} else {
					w += dx;
					start_point.setLocation(e.getX(), start_point.y);
				}
				
				if(h + dy <= min_height) {
					h = min_height;
					start_point.setLocation(start_point.x, min_height - top_inset);
				} else {
					h += dy;
					start_point.setLocation(start_point.x, e.getY());
				}
				
				setBounds(x, y, w, h);
//				if(checkIfMinimumSize(w + dx, h + dy)) {
//					setBounds(x, y, 
//							(int) current_panel.getMinimumSize().getWidth(), 
//							(int) current_panel.getMinimumSize().getHeight());
//					start_point = new Point((int) (current_panel.getLocationOnScreen().getX() + current_panel.getMinimumSize().getWidth() - right_inset),
//							(int) (current_panel.getLocationOnScreen().getY() + current_panel.getMinimumSize().getHeight() - bottom_inset));
//				} else {
//					setBounds(x, y, w + dx, h + dy);
//					start_point = e.getLocationOnScreen();
//				}
				break;
				
			case Cursor.S_RESIZE_CURSOR:
				if(h + dy <= min_height) {
					h = min_height;
					start_point.setLocation(start_point.x, min_height - top_inset);
				} else {
					h += dy;
					start_point.setLocation(start_point.x, e.getY());
				}
				
				setBounds(x, y, w, h);
//				setBounds(x, y, w, h + dy);
				break;
				
			case Cursor.SW_RESIZE_CURSOR:
				if(w - dx <= min_width) {
					x = right_side - min_width;
					w = min_width;
				} else {
					x += dx;
					w -= dx;
				}
				
				if(h + dy <= min_height) {
					h = min_height;
				} else {
					h +=dy;
					start_point.setLocation(start_point.x, e.getY());
				}
				
				setBounds(x, y, w, h);
//				setBounds(x + dx, y, w - dx, h + dy);
				break;
				
			case Cursor.W_RESIZE_CURSOR:
				if(w - dx <= min_width) {
					x = right_side - min_width;
					w = min_width;
				} else {
					x += dx;
					w -= dx;
				}
				
				setBounds(x, y, w, h);
//				setBounds(x + dx, y, w - dx, h);
				break;
				
			case Cursor.MOVE_CURSOR:
				setBounds(x + dx, y + dy, w, h);
				break;
			}
		}
		
	}

	@Override
	public void mouseMoved(MouseEvent e) {
		current_panel.setCursor(this.getCursor(e.getX(),e.getY()));
	}
	
	private Cursor getCursor(int x, int y) {
		if(y <= top_inset) {
			if(x < left_inset) {
				return Cursor.getPredefinedCursor(Cursor.NW_RESIZE_CURSOR);
			} else if (x < current_panel.getWidth() - right_inset) {
				return Cursor.getPredefinedCursor(Cursor.N_RESIZE_CURSOR);
			} else {
				return Cursor.getPredefinedCursor(Cursor.NE_RESIZE_CURSOR);
			}
			
			
		}else if(x >= current_panel.getWidth() - right_inset) {
			if(y < current_panel.getHeight() - bottom_inset) {
				return Cursor.getPredefinedCursor(Cursor.E_RESIZE_CURSOR);
			} else {
				return Cursor.getPredefinedCursor(Cursor.SE_RESIZE_CURSOR);
			}
			
			
		}else if(y >= current_panel.getHeight() - bottom_inset) {
			if(x < left_inset) {
				return Cursor.getPredefinedCursor(Cursor.SW_RESIZE_CURSOR);
			} else {
				return Cursor.getPredefinedCursor(Cursor.S_RESIZE_CURSOR);
			}
			
			
		}else if(x <= left_inset) {
			return Cursor.getPredefinedCursor(Cursor.W_RESIZE_CURSOR);
			
		} else {
			return Cursor.getPredefinedCursor(Cursor.MOVE_CURSOR);
		}
	}
	
	private void setBounds(int x, int y, int w, int h) {
		current_panel.setBounds(x, y, w, h);
		current_panel.getParent().revalidate();
	}

	private boolean checkIfMinimumSize(int w, int h) {
		if(w <= current_panel.getMinimumSize().getWidth()
				|| h <= current_panel.getMinimumSize().getHeight()) {
			return true;
		} else {
			return false;
		}
	}
}
